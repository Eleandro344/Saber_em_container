{"ast":null,"code":"import React,{useEffect,useState}from'react';import{DragDropContext,Droppable,Draggable}from'@hello-pangea/dnd';import'../styles/tarefas.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const etapas=['PROJETO NA FILA','EM NEGOCIAÇÃO','EXECUÇÃO DO TIME','APRESENTAÇÃO AO CLIENTE','VALORES','ENTREGA AO CLIENTE'];const Tarefas=()=>{const[quadros,setQuadros]=useState([]);const token=localStorage.getItem('access');useEffect(()=>{fetch('http://localhost:8000/api/quadros/',{headers:{Authorization:`Bearer ${token}`}}).then(res=>res.json()).then(data=>{if(Array.isArray(data))setQuadros(data);});},[token]);const calcularStatus=dataCriacao=>{const data=new Date(dataCriacao);const dataLimite=new Date(data);dataLimite.setDate(dataLimite.getDate()+3);const hoje=new Date();const status=hoje<=dataLimite?'Em dia':'Atrasado';const previsao=dataLimite.toLocaleDateString();return{status,previsao};};const onDragEnd=result=>{const{destination,source,draggableId}=result;if(!destination||destination.droppableId===source.droppableId)return;const movedQuadro=quadros.find(q=>q.id.toString()===draggableId);if(!movedQuadro)return;const origemIdx=etapas.indexOf(source.droppableId);const destinoIdx=etapas.indexOf(destination.droppableId);const diff=destinoIdx-origemIdx;const novaDataCriacao=new Date(movedQuadro.criado_em);novaDataCriacao.setDate(novaDataCriacao.getDate()+diff*3);const updatedQuadros=quadros.map(quadro=>quadro.id.toString()===draggableId?{...quadro,situacao:destination.droppableId,criado_em:novaDataCriacao.toISOString()}:quadro);setQuadros(updatedQuadros);fetch(`http://localhost:8000/api/quadros/${draggableId}/`,{method:'PATCH',headers:{'Content-Type':'application/json',Authorization:`Bearer ${token}`},body:JSON.stringify({situacao:destination.droppableId,criado_em:novaDataCriacao.toISOString()})});};return/*#__PURE__*/_jsxs(\"div\",{className:\"kanban-page\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"kanban-title-wrapper\",children:/*#__PURE__*/_jsx(\"h3\",{className:\"kanban-title\",children:\"Quadros por Etapas\"})}),/*#__PURE__*/_jsx(DragDropContext,{onDragEnd:onDragEnd,children:/*#__PURE__*/_jsx(\"div\",{className:\"kanban-container\",children:etapas.map((etapa,idx)=>/*#__PURE__*/_jsxs(\"div\",{className:\"kanban-col\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"kanban-header\",children:etapa}),/*#__PURE__*/_jsx(Droppable,{droppableId:etapa,children:provided=>/*#__PURE__*/_jsxs(\"div\",{className:\"kanban-cards\",ref:provided.innerRef,...provided.droppableProps,children:[quadros.filter(quadro=>quadro.situacao===etapa).map((quadro,index)=>{const{status,previsao}=calcularStatus(quadro.criado_em);return/*#__PURE__*/_jsx(Draggable,{draggableId:quadro.id.toString(),index:index,children:provided=>/*#__PURE__*/_jsxs(\"div\",{className:\"kanban-card\",ref:provided.innerRef,...provided.draggableProps,...provided.dragHandleProps,children:[/*#__PURE__*/_jsx(\"strong\",{children:quadro.nome}),/*#__PURE__*/_jsx(\"p\",{children:quadro.empresa}),/*#__PURE__*/_jsx(\"p\",{children:quadro.responsavel}),/*#__PURE__*/_jsx(\"p\",{className:`status ${status==='Em dia'?'success':'danger'}`,children:status==='Em dia'?'✅ Em dia':'❌ Atrasado'}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Entrega at\\xE9: \",/*#__PURE__*/_jsx(\"strong\",{children:previsao})]})]})},quadro.id);}),provided.placeholder,quadros.filter(quadro=>quadro.situacao===etapa).length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"kanban-card text-muted small\",children:\"Sem tarefas\"})]})})]},idx))})})]});};export default Tarefas;","map":{"version":3,"names":["React","useEffect","useState","DragDropContext","Droppable","Draggable","jsx","_jsx","jsxs","_jsxs","etapas","Tarefas","quadros","setQuadros","token","localStorage","getItem","fetch","headers","Authorization","then","res","json","data","Array","isArray","calcularStatus","dataCriacao","Date","dataLimite","setDate","getDate","hoje","status","previsao","toLocaleDateString","onDragEnd","result","destination","source","draggableId","droppableId","movedQuadro","find","q","id","toString","origemIdx","indexOf","destinoIdx","diff","novaDataCriacao","criado_em","updatedQuadros","map","quadro","situacao","toISOString","method","body","JSON","stringify","className","children","etapa","idx","provided","ref","innerRef","droppableProps","filter","index","draggableProps","dragHandleProps","nome","empresa","responsavel","placeholder","length"],"sources":["C:/Users/elean/salvar_comece/frontend/src/pages/Tarefas.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { DragDropContext, Droppable, Draggable } from '@hello-pangea/dnd';\nimport '../styles/tarefas.css';\n\nconst etapas = [\n  'PROJETO NA FILA',\n  'EM NEGOCIAÇÃO',\n  'EXECUÇÃO DO TIME',\n  'APRESENTAÇÃO AO CLIENTE',\n  'VALORES',\n  'ENTREGA AO CLIENTE'\n];\n\nconst Tarefas = () => {\n  const [quadros, setQuadros] = useState([]);\n  const token = localStorage.getItem('access');\n\n  useEffect(() => {\n    fetch('http://localhost:8000/api/quadros/', {\n      headers: {\n        Authorization: `Bearer ${token}`,\n      }\n    })\n      .then(res => res.json())\n      .then(data => {\n        if (Array.isArray(data)) setQuadros(data);\n      });\n  }, [token]);\n\n  const calcularStatus = (dataCriacao) => {\n    const data = new Date(dataCriacao);\n    const dataLimite = new Date(data);\n    dataLimite.setDate(dataLimite.getDate() + 3);\n    const hoje = new Date();\n\n    const status = hoje <= dataLimite ? 'Em dia' : 'Atrasado';\n    const previsao = dataLimite.toLocaleDateString();\n    return { status, previsao };\n  };\n\n  const onDragEnd = (result) => {\n    const { destination, source, draggableId } = result;\n    if (!destination || destination.droppableId === source.droppableId) return;\n\n    const movedQuadro = quadros.find(q => q.id.toString() === draggableId);\n    if (!movedQuadro) return;\n\n    const origemIdx = etapas.indexOf(source.droppableId);\n    const destinoIdx = etapas.indexOf(destination.droppableId);\n    const diff = destinoIdx - origemIdx;\n\n    const novaDataCriacao = new Date(movedQuadro.criado_em);\n    novaDataCriacao.setDate(novaDataCriacao.getDate() + diff * 3);\n\n    const updatedQuadros = quadros.map(quadro =>\n      quadro.id.toString() === draggableId\n        ? {\n            ...quadro,\n            situacao: destination.droppableId,\n            criado_em: novaDataCriacao.toISOString()\n          }\n        : quadro\n    );\n    setQuadros(updatedQuadros);\n\n    fetch(`http://localhost:8000/api/quadros/${draggableId}/`, {\n      method: 'PATCH',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${token}`,\n      },\n      body: JSON.stringify({\n        situacao: destination.droppableId,\n        criado_em: novaDataCriacao.toISOString(),\n      }),\n    });\n  };\n\n  return (\n    <div className=\"kanban-page\">\n      <div className=\"kanban-title-wrapper\">\n        <h3 className=\"kanban-title\">Quadros por Etapas</h3>\n      </div>\n\n      <DragDropContext onDragEnd={onDragEnd}>\n        <div className=\"kanban-container\">\n          {etapas.map((etapa, idx) => (\n            <div key={idx} className=\"kanban-col\">\n              <div className=\"kanban-header\">{etapa}</div>\n              <Droppable droppableId={etapa}>\n                {(provided) => (\n                  <div\n                    className=\"kanban-cards\"\n                    ref={provided.innerRef}\n                    {...provided.droppableProps}\n                  >\n                    {quadros\n                      .filter(quadro => quadro.situacao === etapa)\n                      .map((quadro, index) => {\n                        const { status, previsao } = calcularStatus(quadro.criado_em);\n                        return (\n                          <Draggable\n                            key={quadro.id}\n                            draggableId={quadro.id.toString()}\n                            index={index}\n                          >\n                            {(provided) => (\n                              <div\n                                className=\"kanban-card\"\n                                ref={provided.innerRef}\n                                {...provided.draggableProps}\n                                {...provided.dragHandleProps}\n                              >\n                                <strong>{quadro.nome}</strong>\n                                <p>{quadro.empresa}</p>\n                                <p>{quadro.responsavel}</p>\n                                <p className={`status ${status === 'Em dia' ? 'success' : 'danger'}`}>\n                                  {status === 'Em dia' ? '✅ Em dia' : '❌ Atrasado'}\n                                </p>\n                                <p>Entrega até: <strong>{previsao}</strong></p>\n                              </div>\n                            )}\n                          </Draggable>\n                        );\n                      })}\n                    {provided.placeholder}\n\n                    {quadros.filter(quadro => quadro.situacao === etapa).length === 0 && (\n                      <div className=\"kanban-card text-muted small\">\n                        Sem tarefas\n                      </div>\n                    )}\n                  </div>\n                )}\n              </Droppable>\n            </div>\n          ))}\n        </div>\n      </DragDropContext>\n    </div>\n  );\n};\n\nexport default Tarefas;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}